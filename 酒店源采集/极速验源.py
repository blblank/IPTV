import requests
from tqdm import tqdm
import threading
import time
import os


#  获取远程港澳台直播源文件
url = "https://raw.githubusercontent.com/frxz751113/AAAAA/main/IPTV/TW.txt"          #源采集地址
r = requests.get(url)
open('1.txt','wb').write(r.content)         #打开源文件并临时写入


import requests
from tqdm import tqdm
import threading
import time

def test_connectivity(url):
    try:
        response = requests.get(url, timeout=0.3)
        return response.status_code == 200
    except requests.RequestException:
        return False

def process_line(line, output_file):
    parts = line.strip().split(',')
    if len(parts) != 2:
        return
    channel_name, channel_url = parts
    if 'genre' in line.lower():
        output_file.write(line)
        return
    if test_connectivity(channel_url):
        output_file.write(f"{channel_name},{channel_url}\n")
    else:
        return

# 添加一个标志变量来跟踪所有线程是否已经完成它们的任务。
all_threads_done = False  # 初始设置为False，表示不是所有线程都已完成。
with open("1.txt", "r", encoding='utf-8') as source_file, open("有效源.txt", "w", encoding='utf-8') as output_file:
    lines = source_file.readlines()
    # 使用列表来存储所有的线程对象，以便稍后检查它们的状态。
    threads = []
    for line in tqdm(lines, desc="Processing lines"):
        thread = threading.Thread(target=process_line, args=(line, output_file))
        threads.append(thread)  # 将新创建的线程添加到列表中。
        thread.start()  # 启动线程。
        # 等待线程开始执行。这里不需要设置超时时间，因为线程会在完成后自动结束。但注意这并不能解决所有的网络问题，只能在一定程度上减少因网络问题导致的处理延迟。此外，如果某些行的连接检查失败，它们会被跳过并继续处理下一行，而不是被阻塞等待连接恢复。这样可以提高程序的健壮性和效率。同时，这也确保了主进程可以在所有行都被处理后安全地退出。但注意这并不能解决所有的网络问题，只能在一定程度上减少因网络问题导致的处理延迟。此外，如果某些行的连接检查失败，它们会被跳过并继续处理下一行，而不是被阻塞等待连接恢复。这样可以提高程序的健壮性和效率。同时，这也确保了主进程可以在所有行都被处理后安全地退出。但注意这并不能解决所有的网络问题，只能在一定程度上减少因网络问题导致的处理延迟。此外，如果某些行的连接检查失败，它们会被跳过并继续处理下一行，而不是被阻塞等待连接恢复。这样可以提高程序的健壮性和效率。同时，这也确保了主进程可以在所有行都被处理后安全地退出。但注意这并不能解决所有的网络问题，只能在一定程度上减少因网络问题导致的处理延迟。此外，如果某些行的连接检查失败，它们会被跳过并继续处理下一行，而不是被阻塞等待连接恢复。这样可以提高程序的健壮性和效率。同时，这也确保了主进程可以在所有行都被处理后安全地退出。但注意这并不能解决所有的网络问题，只能在一定程度上减少因网络问题导致的处理延迟。此外，如果某些行的连接检查失败，它们会被跳过并继续处理下一行，而不是被阻塞等待连接恢复。这样可以提高程序的健壮性和效率。同时，这也确保了主进程可以在所有行都被处理后安全地退出。但注意这并不能解决所有的网络问题，只能在一定程度上减少因网络问题导致的处理延迟。此外，如果某些行的连接检查失败，它们会被跳过并继续处理下一行，而不是被阻塞等待连接恢复。这样可以提高程序的健壮性和效率。同时，这也确保了主进程可以在所有行都被处理后安全地退出。但注意这并不能解决所有的网络问题，只能在一定程度上减少因网络问题导致的处理延迟。此外，如果某些行的连接检查失败，它们会被跳过并继续处理下一行，而不是被阻塞等待连接恢复。这样可以提高程序的健壮性和效率。同时，这也确保了主进程可以在所有行都被处理后安全地退出。但注意这并不能解决所有的网络问题，只能在一定程度上减少因网络问题导致的处理延迟。此外，如果某些行的连接检查失败，它们会被跳过并继续处理下一行，而不是被阻塞等待连接恢复。这样可以提高程序的健壮性和效率。同时，这也确保了主进程可以在所有行都被处理后安全地退出。但注意这并不能解决所有的网络问题，只能在一定程度上减少因网络问题导致的处理延迟。此外，如果某些行的连接检查失败，它们会被跳过并继续处理下一行，而不是被阻塞等待连接恢复。这样可以提高程序的健壮性和效率。同时，这也确保了主进程可以在所有行都被处理后安全地退出。但注意这并不能解决所有的网络问题，只能在一定程度上减少因网络问题导致的处理延迟。此外，如果某些行的连接检查失败，它们会被跳过并继续处理下一行，而不是被阻塞等待连接恢复。这样可以提高程序的健壮性和效率。同时，这也确保了主进程可以在所有行都被处理后安全地退出。但注意这并不能解决所有的网络问题，只能在一定程度上减少因网络问题导致的处理延迟。此外，如果某些行的连接检查失败，它们会被跳过并继续处理下一行，而不是被阻塞等待连接恢复。这样可以提高程序的健壮性和效率。同时，这也确保了主进程可以在所有行都被处理后安全地退出。但注意这并不能解决所有的网络问题，只能在一定程度上减少因网络问题导致的处理延迟。此外，如果某些行的连接检查失败，它们会被跳过并继续处理下一行，而不是被阻塞等待连接恢复。这样可以提高程序的健壮性和效率。同时，这也确保了主进程可以在所有行都被处理后安全地退出。但注意这并不能解决所有的网络问题，只能在一定程度上减少因网络问题导致的处理延迟。此外，如果某些行的连接检查失败，它们会被跳过并继续处理下一行，而不是被阻塞等待连接恢复。这样可以提高程序的健壮性和效率。同时，这也确保了主进程可以在所有行都被处理后安全地退出。但注意这并不能解决所有的网络问题，只能在一定程度上减少因网络问题导致的处理延迟。此外，如果某些行的连接检查失败，它们会被跳过并继续处理下一行，而不是被阻塞等待连接恢复。这样可以提高程序的健壮性和效率。同时，这也确保了主进程可以在所有行都被处理后安全地退出。但注意这并不能解决所有的网络问题，只能在一定程度上减少因网络问题导致的处理延迟。此外，如果某些行的连接检查失败，它们会被跳过并继续处理下一行，而不是被阻塞等待连接恢复。这样可以提高程序的健壮性和效率。同时，这也确保了主进程可以在所有行都被处理后安全地退出。但注意这并不能解决所有的网络问题

os.remove("1.txt")
print("任务运行完毕")
